name: Auto_deployment_front_angular

on:
  push:
    branches:
      - dev
jobs:
    angular:
        runs-on: ubuntu-latest
    
        steps:
        - name: Checkout du code
          uses: actions/checkout@v2
    
        - name: Installer les dépendances
          if: success()  
          run: | 
            cd angular/
            npm install

        - name: Construire l'application
          if: success()  
          run: |
            cd angular/
            npm run build

        - name: Utiliser la clé privée
          if: success()     
          run: |
            echo "$DEPLOY_KEY_PRIVE" > id_rsa
            chmod 600 id_rsa

        - name: Déployer sur la production
          if: success()  
          run: |
            ls -l
            cat id_rsa
            sftp -i id_rsa startupfoundercanvas-preprod@ssh-startupfoundercanvas-preprod.alwaysdata.net << EOF
              put -r angular/dist/startup-founder-canvas-client/* www/
              quit
            EOF